---
title: "Homework 3"
author: "Sarahy Martinez"
date: "10/13/2023"
output: github_document
---

```{r}
library(tidyverse)
library(ggridges)
library(hexbin)
library(patchwork)

knitr:: opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal()+ theme(legend.position = "bottom"))

options(
  
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_fill_discrete = scale_fill_viridis_d()    

scale_colour_discrete = scale_fill_viridis_d() 


```


# Problem 1 

```{r problem 1, eval=FALSE}
library(p8105.datasets)
data("ny_noaa")
```



# Problem 2A 

Reading In, Cleaning, Combining Data 
```{r}

#reading in data and cleaning 
accelerometer_data = read_csv(file = "./data/nhanes_accel.csv", na = c("", "NA", 999)) %>%
  janitor::clean_names() %>%
  mutate(seqn=as.character(seqn)) %>% 
  drop_na()


demographics_data = read_csv(file = "./data/nhanes_covar.csv",na = c("", "NA", 999),
                    skip = 4, col_names =TRUE) %>% 
                    janitor::clean_names() %>% 
                     mutate(seqn=as.character(seqn)) %>% 
                    filter(age >=21) %>% 
                    drop_na()

combined_nhanes = 
  left_join(accelerometer_data, demographics_data, by= "seqn") %>% 
  janitor::clean_names() %>%
  relocate(seqn,sex,age,bmi,education) %>%          
  mutate(sex = recode(sex, "1"= "male", "2"= "female")) %>% 
   mutate(sex= as.factor(sex)) %>% 
          mutate(education=recode(education,
                                  "1"="Less than High School", 
                                  "2"="High School Equivalent", 
                                  "3"="More than High School")) %>% 
  mutate(education= fct_relevel(education, "Less than High School", "High School Equivalent", "More than High School")) %>% 
  drop_na(sex,age,bmi,education)

```

## 2B Producing reader friendly table for number of men and women in each education category 

```{r}
combined_nhanes %>% 
            group_by(sex,education) %>% 
            summarize(counts= n()) %>% 
            pivot_wider(
              names_from = education,
              values_from = counts,
              names_prefix = "Education "
            ) %>% 
  knitr::kable()
        

```
Based on this output more men have a high school equivalent education whereas more women either have less than a high school education or more than a high school education but they do not vary as much from the men.


Age Distributions of each category
```{r}

 demo_data= combined_nhanes %>% 
  select(age,sex,education) %>% 
  filter(age>=21) %>% 
  drop_na()


ggplot(demo_data, aes(x = age, fill = sex)) + 
  geom_density(alpha = 0.5) + 
  facet_grid(. ~ education) +
  theme_minimal()+
   labs(
    title = "Age Distributions of Sex and Education Level",
    x = "Age",
    y= "Density"
  )


```
From this plot we can see that females between the ages 20 and 40 have an education greater than high school in comparison to men. Whereas men have also who habe more than a highschool dregree are 20-40 but there are not as many. Additonally, those who have less than a high school dregree begin to somewhat overlap between men and women around 60-80 and lastly for high school equivalent women tended to be between 60 and 80 whereas mean were 20-40. 

## Problem 2C Aggregating Across Minutes to Create Total Activity 

```{r}

 aggregate_data = combined_nhanes %>% 
  mutate(total_activity= rowSums(select(.,starts_with("min")))) %>% 
  select(total_activity, age, sex, education)


ggplot(aggregate_data, aes(x=age, y=total_activity, color=sex))+
  geom_point(alpha= .5)+
  geom_smooth(se= FALSE)+
  facet_grid(. ~ education)+
  labs(
    title = "Age vs Total Activity Among Men and Women Varying By Education",
    x = "Age",
    y= "Total Activity"
  )

```
In this graph we can see a commonality in the slope changes, all educations have a negative slope. This implies that as age increases amount of total activity increases among all of the education categories. However, we can note that for women who have a high school equivalent education their total physical activity drops tremendously between the ages of 40 and 60 whereas men in the less than high schools education physical activity drops tremendously after the ages 60-80. Another commonality is that at around age 80 across the education levels men and women have about the same amount of total activity being about 10,000 min. 

## Problem 2D 

Three panel plot showing 24 hour activity time course 
```{r}
 
activity_twenty_four_hour = combined_nhanes %>%
  pivot_longer(
    cols = starts_with("min"),
    names_to = "minute", 
    values_to = "activity",
    names_prefix = "min") %>%
  mutate(minute = as.numeric(minute)) %>% 
  mutate(hour= minute/60) 

ggplot(activity_twenty_four_hour, aes(x=hour, y= activity, color=sex, group =seqn))+
  geom_line(alpha= .2)+
  geom_smooth(aes(group = sex),se= FALSE)+
  facet_grid(. ~ education)+
  labs(
    title = "24- Hour Activity Time by Education Attainment",
    x = "Hours",
    y= "Actvity"
  )


```
Based off of this graph we can see that within 24 hours that amount of activity for men and women overlap between those who attained less than or equivalent to a high school education. Whereas for those who have more than a high school education women seem to have higher rates of activity within the time window of 5-10 hours and men peak at around the 20 hour window. 



# Problem 3


Importing the data 

```{r}

jan_2020 = read_csv(file = "./data/Jan_2020_Citi.csv", na = c("", "NA", 999)) %>% 
  janitor::clean_names() %>% 
  mutate(month_year = "jan_2020") %>% 
  drop_na()

jan_2024 = read_csv(file = "./data/Jan_2024_Citi.csv", na = c("", "NA", 999)) %>% 
  janitor::clean_names()%>% 
  mutate(month_year = "jan_2024") %>% 
  drop_na()

july_2024 = read_csv(file = "./data/July_2024_Citi.csv", na = c("", "NA", 999)) %>% 
  janitor::clean_names() %>% 
  mutate(month_year = "july_2024") %>% 
  drop_na()


july_2020 = read_csv(file = "./data/July_2020_Citi.csv", na = c("", "NA", 999)) %>% 
  janitor::clean_names() %>% 
  mutate(month_year = "july_2020") %>% 
  drop_na()


combined_years_data =  
  bind_rows(jan_2020, jan_2024, july_2020, july_2024)


# producing reader friendly table 

combined_years_data %>% 
separate(month_year, into = c("month", "year"), sep = "_") %>% 
  group_by(month, year, member_casual) %>% 
  count(ride_id = "total_rides") %>% 
  pivot_wider(
    names_from = "member_casual",
    values_from = "n"
  ) %>% 
  select(-ride_id) %>% 
  knitr::kable()

```




























